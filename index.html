<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irish Recruitment Agency Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }

        .controls h3 {
            color: #2c3e50;
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: 600;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }

        .filters {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 25px;
            margin-bottom: 20px;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .filter-section h4 {
            color: #2c3e50;
            font-size: 1rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 0.9rem;
            display: block;
        }

        select, input[type="text"] {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            background: white;
        }

        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .contact-filter {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .checkbox-group label {
            margin: 0;
            font-weight: 500;
            color: #495057;
            cursor: pointer;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success:hover {
            background: #229954;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-weight: 500;
        }

        .results {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .results-header {
            background: #34495e;
            color: white;
            padding: 20px 25px;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-emails-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .copy-emails-btn:hover {
            background: #229954;
        }

        .copy-emails-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .agency-grid {
            display: grid;
            gap: 1px;
            background: #ecf0f1;
            max-height: 600px;
            overflow-y: auto;
        }

        .agency-card {
            background: white;
            padding: 20px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .agency-card:hover {
            background: #f8f9fa;
            border-left-color: #3498db;
        }

        .agency-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .agency-location {
            color: #7f8c8d;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .agency-fields {
            background: #ecf0f1;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #5d6d7e;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .contact-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 0.9rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #5d6d7e;
        }

        .contact-icon {
            width: 16px;
            height: 16px;
            opacity: 0.7;
        }

        .contact-link {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }

        .contact-link:hover {
            text-decoration: underline;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .no-results h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #5d6d7e;
        }

        @media (max-width: 1024px) {
            .filters {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .contact-info {
                grid-template-columns: 1fr;
            }
        }

        .file-upload {
            margin-bottom: 20px;
            text-align: center;
        }

        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .upload-area.dragover {
            border-color: #2980b9;
            background: rgba(41, 128, 185, 0.1);
        }

        #fileInput {
            display: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .notification.success {
            background: #27ae60;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üáÆüá™ Irish Recruitment Agency Dashboard</h1>
            <p>Explore 946+ recruitment agencies across Ireland with advanced filtering</p>
        </div>

        <div class="file-upload">
            <div class="upload-area" id="uploadArea">
                <h3>üìÅ Upload Your CSV File</h3>
                <p>Drag and drop your enriched_recruitment_v10_with_fields.csv file here, or click to browse</p>
                <input type="file" id="fileInput" accept=".csv" />
            </div>
        </div>

        <div class="controls" id="controlsSection" style="display: none;">
            <h3>üîç Filter Options</h3>
            
            <div class="filters">
                <div class="filter-section">
                    <h4>Location & Search</h4>
                    <div class="filter-group">
                        <label for="countyFilter">County</label>
                        <select id="countyFilter">
                            <option value="">All Counties</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="searchInput">Agency Name</label>
                        <input type="text" id="searchInput" placeholder="Type agency name...">
                    </div>
                </div>
                
                <div class="filter-section">
                    <h4>Specialization</h4>
                    <div class="filter-group">
                        <label for="fieldsFilter">Covered Fields</label>
                        <select id="fieldsFilter">
                            <option value="">All Fields</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-section">
                    <h4>Contact Information Available</h4>
                    <div class="contact-filter">
                        <div class="checkbox-group">
                            <input type="checkbox" id="hasEmail" value="email">
                            <label for="hasEmail">Email</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="hasPhone" value="phone">
                            <label for="hasPhone">Phone</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="hasWebsite" value="website">
                            <label for="hasWebsite">Website</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                <button class="btn btn-secondary" onclick="clearFilters()">Clear All</button>
            </div>
        </div>

        <div class="stats" id="statsSection" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalAgencies">0</div>
                <div class="stat-label">Total Agencies</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="filteredAgencies">0</div>
                <div class="stat-label">Filtered Results</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="uniqueCounties">0</div>
                <div class="stat-label">Counties</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="uniqueFields">0</div>
                <div class="stat-label">Specializations</div>
            </div>
        </div>

        <div class="results" id="resultsSection" style="display: none;">
            <div class="results-header">
                <span id="resultsTitle">Search Results</span>
                <button class="copy-emails-btn" id="copyEmailsBtn" onclick="copyAllEmails()">
                    üìß Copy All Emails
                </button>
            </div>
            <div class="agency-grid" id="agencyGrid">
                <!-- Results will be populated here -->
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        let agencies = [];
        let filteredAgencies = [];

        // File upload functionality
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');

        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                alert('Please upload a CSV file');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                parseCSV(e.target.result);
            };
            reader.readAsText(file);
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(';').map(h => h.trim());
            
            agencies = [];
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(';').map(v => v.trim());
                    const agency = {};
                    headers.forEach((header, index) => {
                        agency[header] = values[index] || '';
                    });
                    agencies.push(agency);
                }
            }

            console.log(`Loaded ${agencies.length} agencies`);
            initializeDashboard();
        }

        function initializeDashboard() {
            // Show dashboard sections
            document.getElementById('controlsSection').style.display = 'block';
            document.getElementById('statsSection').style.display = 'grid';
            document.getElementById('resultsSection').style.display = 'block';

            // Populate filter options
            populateCountyFilter();
            populateFieldsFilter();
            
            // Initialize with all agencies
            filteredAgencies = [...agencies];
            updateStats();
            displayResults();
        }

        function populateCountyFilter() {
            const counties = [...new Set(agencies.map(a => a.County).filter(c => c))].sort();
            const select = document.getElementById('countyFilter');
            select.innerHTML = '<option value="">All Counties</option>';
            counties.forEach(county => {
                select.innerHTML += `<option value="${county}">${county}</option>`;
            });
        }

        function populateFieldsFilter() {
            const allFields = new Set();
            agencies.forEach(agency => {
                if (agency.Covered_Fields) {
                    const fields = agency.Covered_Fields.split(/[,|;]/).map(f => f.trim());
                    fields.forEach(field => {
                        if (field) allFields.add(field);
                    });
                }
            });
            
            const sortedFields = [...allFields].sort();
            const select = document.getElementById('fieldsFilter');
            select.innerHTML = '<option value="">All Fields</option>';
            sortedFields.forEach(field => {
                select.innerHTML += `<option value="${field}">${field}</option>`;
            });
        }

        function applyFilters() {
            const countyFilter = document.getElementById('countyFilter').value;
            const fieldsFilter = document.getElementById('fieldsFilter').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const hasEmail = document.getElementById('hasEmail').checked;
            const hasPhone = document.getElementById('hasPhone').checked;
            const hasWebsite = document.getElementById('hasWebsite').checked;

            filteredAgencies = agencies.filter(agency => {
                // County filter
                if (countyFilter && agency.County !== countyFilter) {
                    return false;
                }

                // Fields filter
                if (fieldsFilter && !agency.Covered_Fields.includes(fieldsFilter)) {
                    return false;
                }

                // Search filter
                if (searchInput && !agency.Agency_Name.toLowerCase().includes(searchInput)) {
                    return false;
                }

                // Contact filters - if any checkbox is selected, agency must have at least one of the selected contact methods
                if (hasEmail || hasPhone || hasWebsite) {
                    let hasRequiredContact = false;
                    if (hasEmail && agency.Email && agency.Email.trim()) hasRequiredContact = true;
                    if (hasPhone && agency.Phone && agency.Phone.trim()) hasRequiredContact = true;
                    if (hasWebsite && agency.Website && agency.Website.trim()) hasRequiredContact = true;
                    
                    if (!hasRequiredContact) return false;
                }

                return true;
            });

            updateStats();
            displayResults();
        }

        function clearFilters() {
            document.getElementById('countyFilter').value = '';
            document.getElementById('fieldsFilter').value = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('hasEmail').checked = false;
            document.getElementById('hasPhone').checked = false;
            document.getElementById('hasWebsite').checked = false;
            filteredAgencies = [...agencies];
            updateStats();
            displayResults();
        }

        function copyAllEmails() {
            const emails = [];
            filteredAgencies.forEach(agency => {
                if (agency.Email && agency.Email.trim()) {
                    // Handle multiple emails separated by | or ;
                    const agencyEmails = agency.Email.split(/[|;]/).map(email => email.trim()).filter(email => email);
                    emails.push(...agencyEmails);
                }
            });

            // Remove duplicates
            const uniqueEmails = [...new Set(emails)];
            
            if (uniqueEmails.length === 0) {
                showNotification('No emails found in current results');
                return;
            }

            // Format for email clients (comma-separated)
            const emailString = uniqueEmails.join('; ');
            
            // Copy to clipboard
            navigator.clipboard.writeText(emailString).then(() => {
                showNotification(`${uniqueEmails.length} emails copied to clipboard!`);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = emailString;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification(`${uniqueEmails.length} emails copied to clipboard!`);
            });
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification success show';
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function updateStats() {
            document.getElementById('totalAgencies').textContent = agencies.length;
            document.getElementById('filteredAgencies').textContent = filteredAgencies.length;
            
            const uniqueCounties = new Set(agencies.map(a => a.County).filter(c => c)).size;
            document.getElementById('uniqueCounties').textContent = uniqueCounties;
            
            const uniqueFields = new Set();
            agencies.forEach(agency => {
                if (agency.Covered_Fields) {
                    const fields = agency.Covered_Fields.split(/[,|;]/).map(f => f.trim());
                    fields.forEach(field => {
                        if (field) uniqueFields.add(field);
                    });
                }
            });
            document.getElementById('uniqueFields').textContent = uniqueFields.size;

            document.getElementById('resultsTitle').textContent = 
                `Showing ${filteredAgencies.length} of ${agencies.length} agencies`;

            // Update copy button state
            const copyBtn = document.getElementById('copyEmailsBtn');
            const emailCount = filteredAgencies.filter(a => a.Email && a.Email.trim()).length;
            copyBtn.disabled = emailCount === 0;
            copyBtn.textContent = emailCount > 0 ? `üìß Copy All Emails (${emailCount})` : 'üìß No Emails';
        }

        function displayResults() {
            const grid = document.getElementById('agencyGrid');
            
            if (filteredAgencies.length === 0) {
                grid.innerHTML = `
                    <div class="no-results">
                        <h3>No agencies found</h3>
                        <p>Try adjusting your filters or search criteria</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredAgencies.map(agency => `
                <div class="agency-card">
                    <div class="agency-name">${agency.Agency_Name}</div>
                    <div class="agency-location">üìç ${agency.County}</div>
                    ${agency.Covered_Fields ? `<div class="agency-fields">üéØ ${agency.Covered_Fields}</div>` : ''}
                    
                    <div class="contact-info">
                        ${agency.Phone ? `
                            <div class="contact-item">
                                <span class="contact-icon">üìû</span>
                                <a href="tel:${agency.Phone}" class="contact-link">${agency.Phone}</a>
                            </div>
                        ` : ''}
                        
                        ${agency.Email ? `
                            <div class="contact-item">
                                <span class="contact-icon">‚úâÔ∏è</span>
                                <a href="mailto:${agency.Email.split('|')[0].trim()}" class="contact-link">${agency.Email.split('|')[0].trim()}</a>
                            </div>
                        ` : ''}
                        
                        ${agency.Website ? `
                            <div class="contact-item">
                                <span class="contact-icon">üåê</span>
                                <a href="${agency.Website.split('|')[0].trim()}" target="_blank" class="contact-link">Visit Website</a>
                            </div>
                        ` : ''}
                        
                        ${agency.Address ? `
                            <div class="contact-item">
                                <span class="contact-icon">üè¢</span>
                                <span>${agency.Address}</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Real-time filtering
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('countyFilter').addEventListener('change', applyFilters);
        document.getElementById('fieldsFilter').addEventListener('change', applyFilters);
        document.getElementById('hasEmail').addEventListener('change', applyFilters);
        document.getElementById('hasPhone').addEventListener('change', applyFilters);
        document.getElementById('hasWebsite').addEventListener('change', applyFilters);
    </script>
</body>
</html>